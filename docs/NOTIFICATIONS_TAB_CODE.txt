// Notifications Management Tab Content - To be inserted in AdminPanel.tsx after Contacts tab

/* Add this right after the Contacts PivotItem closes (around line 1407) */

        {/* Tab: Notifications Management */}
        <PivotItem headerText="ğŸ”” Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙˆØ§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª" itemKey="notifications" itemIcon="Ringer">
          <div style={{ padding: '20px 0' }}>
            <Stack horizontal horizontalAlign="space-between" style={{ marginBottom: 16 }}>
              <div>
                <h3 style={{ margin: 0 }}>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù„Ù„Ù…Ø¯Ø§Ø±Ø³</h3>
                <Text variant="small" style={{ color: '#666' }}>
                  Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„ØªÙŠ Ø³ØªØµÙ„ Ù„Ù„Ù…Ø¯Ø§Ø±Ø³
                </Text>
              </div>
              <PrimaryButton
                text="Ø¥Ø´Ø¹Ø§Ø± Ø¬Ø¯ÙŠØ¯"
                iconProps={{ iconName: 'Add' }}
                onClick={() => {
                  setEditingAnnouncement(null)
                  setAnnouncementPanelOpen(true)
                }}
              />
            </Stack>

            <MessageBar messageBarType={MessageBarType.info} styles={{ root: { marginBottom: 16 }}>
              Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø³ØªØ¸Ù‡Ø± Ù„Ù„Ù…Ø¯Ø§Ø±Ø³ ÙÙŠ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø¬Ø±Ø³ (ğŸ””) Ø£Ø¹Ù„Ù‰ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚. ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¯Ø§Ø±Ø³ Ø£Ùˆ Ù…Ø¯Ø§Ø±Ø³ Ù…Ø­Ø¯Ø¯Ø©.
            </MessageBar>

            {/* Announcements Table */}
            <div className="card" style={{ padding: 20 }}>
              <DetailsList
                items={announcements.sort((a, b) => new Date(b.publishDate).getTime() - new Date(a.publishDate).getTime())}
                columns={[
                  {
                    key: 'priority',
                    name: 'Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©',
                    minWidth: 80,
                    maxWidth: 100,
                    onRender: (item: Announcement) => {
                      const icons = {
                        critical: { icon: 'ğŸš¨', color: '#d83b01', label: 'Ø¹Ø§Ø¬Ù„' },
                        urgent: { icon: 'âš ï¸', color: '#ff8c00', label: 'Ù…Ù‡Ù…' },
                        normal: { icon: 'ğŸ“¢', color: '#0078d4', label: 'Ø¹Ø§Ø¯ÙŠ' }
                      }
                      const p = icons[item.priority]
                      return (
                        <span style={{ display: 'flex', alignItems: 'center', gap: 4, color: p.color, fontWeight: 600 }}>
                          {p.icon} {p.label}
                        </span>
                      )
                    }
                  },
                  {
                    key: 'Title',
                    name: 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†',
                    minWidth: 200,
                    maxWidth: 300,
                    isMultiline: true,
                    onRender: (item: Announcement) => <strong>{item.Title}</strong>
                  },
                  {
                    key: 'message',
                    name: 'Ø§Ù„Ø±Ø³Ø§Ù„Ø©',
                    minWidth: 300,
                    maxWidth: 400,
                    isMultiline: true,
                    onRender: (item: Announcement) => (
                      <div style={{ whiteSpace: 'pre-wrap', maxHeight: 60, overflow: 'hidden', textOverflow: 'ellipsis' }}>
                        {item.message.length > 150 ? item.message.substring(0, 150) + '...' : item.message}
                      </div>
                    )
                  },
                  {
                    key: 'targetAudience',
                    name: 'Ø§Ù„ÙØ¦Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©',
                    minWidth: 120,
                    maxWidth: 150,
                    onRender: (item: Announcement) => (
                      <span>
                        {item.targetAudience === 'all' ? 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¯Ø§Ø±Ø³' : `${item.targetSchools?.length || 0} Ù…Ø¯Ø±Ø³Ø©`}
                      </span>
                    )
                  },
                  {
                    key: 'publishDate',
                    name: 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø´Ø±',
                    minWidth: 120,
                    maxWidth: 150,
                    onRender: (item: Announcement) => renderDate(item.publishDate)
                  },
                  {
                    key: 'isActive',
                    name: 'Ø§Ù„Ø­Ø§Ù„Ø©',
                    minWidth: 80,
                    maxWidth: 100,
                    onRender: (item: Announcement) => {
                      const now = new Date()
                      const expired = item.expiryDate && new Date(item.expiryDate) < now
                      return (
                        <span style={{ color: expired ? '#999' : item.isActive ? '#107c10' : '#d83b01' }}>
                          {expired ? 'â±ï¸ Ù…Ù†ØªÙ‡ÙŠ' : item.isActive ? 'âœ… Ù†Ø´Ø·' : 'â¸ï¸ Ù…ØªÙˆÙ‚Ù'}
                        </span>
                      )
                    }
                  },
                  {
                    key: 'actions',
                    name: 'Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª',
                    minWidth: 120,
                    maxWidth: 150,
                    onRender: (item: Announcement) => (
                      <Stack horizontal tokens={{ childrenGap: 8 }}>
                        <IconButton
                          iconProps={{ iconName: 'Edit' }}
                          title="ØªØ¹Ø¯ÙŠÙ„"
                          onClick={() => {
                            setEditingAnnouncement(item)
                            setAnnouncementPanelOpen(true)
                          }}
                        />
                        <IconButton
                          iconProps={{ iconName: item.isActive ? 'CirclePause' : 'Play' }}
                          title={item.isActive ? 'Ø¥ÙŠÙ‚Ø§Ù' : 'ØªÙ†Ø´ÙŠØ·'}
                          onClick={async () => {
                            try {
                              await AnnouncementService.updateAnnouncement(item.id, { isActive: !item.isActive })
                              const updated = await AnnouncementService.getAnnouncements()
                              setAnnouncements(updated)
                              setMessage({
                                type: MessageBarType.success,
                                text: item.isActive ? 'ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±' : 'ØªÙ… ØªÙ†Ø´ÙŠØ· Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±'
                              })
                            } catch (e) {
                              setMessage({ type: MessageBarType.error, text: 'Ø­Ø¯Ø« Ø®Ø·Ø£' })
                            }
                          }}
                        />
                        <IconButton
                          iconProps={{ iconName: 'Delete' }}
                          title="Ø­Ø°Ù"
                          onClick={async () => {
                            if (window.confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±ØŸ')) {
                              try {
                                await AnnouncementService.deleteAnnouncement(item.id)
                                const updated = await AnnouncementService.getAnnouncements()
                                setAnnouncements(updated)
                                setMessage({ type: MessageBarType.success, text: 'ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±' })
                              } catch (e) {
                                setMessage({ type: MessageBarType.error, text: 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù' })
                              }
                            }
                          }}
                        />
                      </Stack>
                    )
                  }
                ]}
                layoutMode={DetailsListLayoutMode.justified}
                selectionMode={SelectionMode.none}
              />

              {announcements.length === 0 && (
                <div style={{ textAlign: 'center', padding: 40, color: '#666' }}>
                  <Icon iconName="Ringer" style={{ fontSize: 48, marginBottom: 16, opacity: 0.3 }} />
                  <Text variant="large" block>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</Text>
                  <Text variant="small" block style={{ marginTop: 8 }}>
                    Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø¥Ø´Ø¹Ø§Ø± Ø¬Ø¯ÙŠØ¯" Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø£ÙˆÙ„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…Ø¯Ø§Ø±Ø³
                  </Text>
                </div>
              )}
            </div>

            {/* Announcement Form Panel */}
            <Panel
              isOpen={announcementPanelOpen}
              onDismiss={() => {
                setAnnouncementPanelOpen(false)
                setEditingAnnouncement(null)
              }}
              type={PanelType.medium}
              headerText={editingAnnouncement ? 'ØªØ¹Ø¯ÙŠÙ„ Ø¥Ø´Ø¹Ø§Ø±' : 'Ø¥Ø´Ø¹Ø§Ø± Ø¬Ø¯ÙŠØ¯'}
              closeButtonAriaLabel="Ø¥ØºÙ„Ø§Ù‚"
            >
              <AnnouncementForm
                announcement={editingAnnouncement}
                schools={schools}
                onSave={async (announcement) => {
                  try {
                    if (editingAnnouncement) {
                      await AnnouncementService.updateAnnouncement(editingAnnouncement.id, announcement)
                      setMessage({ type: MessageBarType.success, text: 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±' })
                    } else {
                      await AnnouncementService.createAnnouncement(announcement as Omit<Announcement, 'id'>)
                      setMessage({ type: MessageBarType.success, text: 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±' })
                    }
                    const updated = await AnnouncementService.getAnnouncements()
                    setAnnouncements(updated)
                    setAnnouncementPanelOpen(false)
                    setEditingAnnouncement(null)
                  } catch (e) {
                    setMessage({ type: MessageBarType.error, text: 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸' })
                  }
                }}
                onCancel={() => {
                  setAnnouncementPanelOpen(false)
                  setEditingAnnouncement(null)
                }}
              />
            </Panel>
          </div>
        </PivotItem>
